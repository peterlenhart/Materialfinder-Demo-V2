<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Material Finder</title>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
  *{ box-sizing:border-box; }

  body{
    margin:0;
    font-family:Arial, sans-serif;
    background:#f4f6fa;
    display:flex;
    justify-content:center;
    color:#222;
  }

  .app{
    width:100%;
    max-width:480px;
    padding:20px 16px 40px;
  }

  h1{
    text-align:center;
    margin:0 0 12px;
    font-size:2rem;
  }

  /* --- Kleiner Import-Button --- */
  .excel-icon-btn{
    width:42px;
    height:42px;
    border-radius:12px;
    padding:0;
    border:none;
    background:#d9d9d9;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
  }

  .excel-icon{
    font-size:1.5rem;
  }

  #statusText{
    font-size:0.75rem;
    color:#777;
    margin-left:10px;
  }

  .top-row{
    display:flex;
    align-items:center;
    justify-content:flex-start;
    gap:8px;
    margin-bottom:12px;
  }

  /* Material Buttons */
  .materials{
    margin:16px 0;
    display:grid;
    grid-template-columns:repeat(2,1fr);
    gap:8px;
  }

  .mat-btn{
    background:#4b4f57;
    border:none;
    border-radius:12px;
    padding:12px 0;
    color:#fff;
    font-size:1rem;
  }

  .mat-btn.active{
    background:#0050a0;
  }

  /* HÃ¶he/Breite Auswahl */
  .dimension-area{
    display:none;
    margin-top:10px;
  }

  .dim-row-labels,
  .dim-row-selects{
    display:grid;
    grid-template-columns:repeat(2,1fr);
    gap:10px;
  }

  .dim-label{
    font-size:1rem;
    font-weight:bold;
  }

  .dim-picker{
    position:relative;
  }

  select{
    width:100%;
    padding:12px;
    font-size:1.2rem;
    border-radius:12px;
    border:1px solid #cdd4e0;
    background:#fff;
    appearance:none;
    -webkit-appearance:none;
  }

  .dim-picker::after{
    content:"â–¾";
    position:absolute;
    right:12px;
    top:50%;
    transform:translateY(-50%);
    color:#666;
  }

  .search-btn{
    margin-top:16px;
    width:100%;
    padding:14px;
    border:none;
    border-radius:12px;
    font-size:1.2rem;
    background:#0050a0;
    color:white;
  }

  /* Ergebnisfeld */
  .result-area{
    margin-top:24px;
    display:none;
    flex-direction:column;
    align-items:center;
    gap:10px;
  }

  .result-card{
    background:#0090d8;            /* schÃ¶nes helleres Cyan-Blau */
    width:min(40vh,40vw);
    height:min(40vh,40vw);
    max-width:260px;
    max-height:260px;
    border-radius:24px;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    gap:12px;
    padding:16px;
  }

  .result-matnr{
    background:#fff;
    padding:8px 16px;
    border-radius:14px;
    font-size:1.6rem;
    letter-spacing:0.2rem;
  }

  .result-number{
    font-size:3.6rem;
    font-weight:bold;
    color:#ffd600;
  }

  .result-regal{
    font-size:1.6rem;
    font-weight:600;
  }

  .result-info{
    font-size:0.9rem;
    color:#666;
  }
</style>
</head>

<body>
<div class="app">
  <h1>Material Finder</h1>

  <div class="top-row">
    <button class="excel-icon-btn" id="excelBtn">
      <span class="excel-icon">ðŸ“¥</span>
    </button>
    <div id="statusText">
      Keine Excel-Daten importiert (Demo aktiv)
    </div>
  </div>

  <input type="file" id="excelInput" accept=".xlsx,.xls" style="display:none"/>

  <div class="materials">
    <button class="mat-btn" data-mat="K110">K110</button>
    <button class="mat-btn" data-mat="Tlx">Tlx</button>
    <button class="mat-btn" data-mat="Toolox">Toolox</button>
    <button class="mat-btn" data-mat="W300">W300</button>
  </div>

  <div class="dimension-area" id="dimensionArea">
    <div class="dim-row-labels">
      <div class="dim-label">HÃ¶he</div>
      <div class="dim-label">Breite</div>
    </div>

    <div class="dim-row-selects">
      <div class="dim-picker">
        <select id="heightSelect"></select>
      </div>
      <div class="dim-picker">
        <select id="widthSelect"></select>
      </div>
    </div>

    <button class="search-btn" id="searchBtn">Suchen</button>
  </div>

  <div class="result-area" id="resultArea">
    <div class="result-card">
      <div class="result-matnr" id="resultMatnr">----</div>
      <div class="result-number" id="resultNumber">-</div>
    </div>
    <div class="result-regal" id="resultRegal">Regal -</div>
    <div class="result-info" id="resultInfo"></div>
  </div>

</div>


<script>
let dataRows = [];
let usingExcel = false;
let selectedWerkstoff = null;

const demoData = [
  { Mat:"7900001015", Werkstoff:"K110",  MaÃŸe:"40 x 60", Lag:"5.1" },
  { Mat:"7900002014", Werkstoff:"K110",  MaÃŸe:"50 x 70", Lag:"6.1" },
  { Mat:"7900003013", Werkstoff:"W300",  MaÃŸe:"40 x 60", Lag:"3.2" },
  { Mat:"7900004012", Werkstoff:"Tlx",   MaÃŸe:"40 x 60", Lag:"2.1" },
  { Mat:"7900005011", Werkstoff:"Toolox",MaÃŸe:"40 x 60", Lag:"4.1" }
];

function parseMasze(str){
  const parts = String(str).split(/x|Ã—/i).map(s => Number(s.trim()));
  if(parts.length<2) return {};
  return {
    height: Math.min(parts[0],parts[1]),
    width : Math.max(parts[0],parts[1])
  };
}

function parseLag(str){
  const p = String(str).split(".");
  return { feld:p[0]||"-", regal:p[1]||"-" };
}

function buildPickers(w){
  const rows=dataRows.filter(r => String(r.Werkstoff).trim()===w);

  let heights=new Set();
  let widths =new Set();

  rows.forEach(r=>{
    const {height,width}=parseMasze(r.MaÃŸe);
    if(height && width){
      heights.add(height);
      widths.add(width);
    }
  });

  const hSel=document.getElementById("heightSelect");
  const wSel=document.getElementById("widthSelect");

  hSel.innerHTML="";
  wSel.innerHTML="";

  [...heights].sort((a,b)=>a-b).forEach(v=>{
    const o=document.createElement("option");
    o.value=v; o.textContent=v;
    hSel.appendChild(o);
  });

  [...widths].sort((a,b)=>a-b).forEach(v=>{
    const o=document.createElement("option");
    o.value=v; o.textContent=v;
    wSel.appendChild(o);
  });

  document.getElementById("dimensionArea").style.display =
    (heights.size>0 && widths.size>0) ? "block":"none";
}

function updateStatus(){
  statusText.textContent = usingExcel
    ? `Excel importiert: ${dataRows.length} DatensÃ¤tze`
    : `Keine Excel-Daten importiert (Demo aktiv)`;
}

function showResult(row){
  if(!row){
    resultArea.style.display="none";
    return;
  }

  const matShort = String(row.Mat).slice(-4);
  const {feld,regal} = parseLag(row.Lag);

  resultMatnr.textContent = matShort;
  resultNumber.textContent = feld;
  resultRegal.textContent = `Regal ${regal}`;
  resultInfo.textContent = `Materialnummer: ${row.Mat}`;

  resultArea.style.display = "flex";
}

excelBtn.onclick = ()=> excelInput.click();

excelInput.onchange = (e)=>{
  const file=e.target.files[0];
  if(!file) return;

  const reader=new FileReader();
  reader.onload=(evt)=>{
    const wb=XLSX.read(new Uint8Array(evt.target.result),{type:"array"});
    const sheet=wb.Sheets[wb.SheetNames[0]];
    dataRows=XLSX.utils.sheet_to_json(sheet,{defval:""});
    usingExcel=true;
    updateStatus();

    if(selectedWerkstoff) buildPickers(selectedWerkstoff);
  };
  reader.readAsArrayBuffer(file);
};

document.querySelectorAll(".mat-btn").forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll(".mat-btn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    selectedWerkstoff = btn.dataset.mat;
    buildPickers(selectedWerkstoff);
    resultArea.style.display="none";
  };
});

searchBtn.onclick=()=>{
  if(!selectedWerkstoff) return;

  const h=Number(heightSelect.value);
  const w=Number(widthSelect.value);

  const row=dataRows.find(r=>{
    if(String(r.Werkstoff).trim()!==selectedWerkstoff) return false;
    const {height,width}=parseMasze(r.MaÃŸe);
    return height===h && width===w;
  });

  showResult(row||null);
};

(function init(){
  dataRows = demoData;
  usingExcel=false;
  updateStatus();
})();
</script>

</body>
</html>
